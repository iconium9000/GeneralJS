<head> <title id="title">General Project!</title></head>

<body style="background-color:black;">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<canvas id="canvas" style="boarder:1px solid #000000" cursor="none">
	Your browser does not support canvas element
</canvas>
<script>
	INDEX_CANVAS = document.getElementById('canvas')
	GAME_HIDE_CURSER = true
	SRVR_CLNT_ID = 0

	PROJ_PATH = 'game/'
	CLNT_PATH = 'client/'
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
<script src="client/fu.js"></script>
<script src="client/pt.js"></script>
<script src="client/usr_io.js">
	// USR_IO_KYS()
	// USR_IO_MWS
	// USR_IO_SET_MWS()
	// USR_IO_DSPLY()
	// USR_IO_EVNTS()
</script>

<script src="/socket.io/socket.io.js"></script>
<script>
CLNT_SKT = io()
// , {
//   // WARNING: in that case, there is no fallback to long-polling
//   transports: [ 'websocket' ] // or [ 'websocket', 'polling' ], which is the same thing
// })

var reqFrame = FU.reqFrame()

CLNT = {}
CLNT_ID = null
CLNT_KEY = null
CLNT_NAME = document.cookie.length ?
  document.cookie.split('=')[1] : 'Wisely'

var wisely_idx = 0
var wisely_txt = [
	[`Choose a name for the game.
Choose wisely, as it can't be changed later.`,`Wisely`],
	[`Ha-ha. Very funny`],
	[`Please Choose a name for the game.
Choose wisely, as it can't be changed later.`,`Changed Later`,],
	[`It can't be changed later.
Please type another name.`,`Another Name`,],
	[`I'm getting sick of you.`]
]
while (true) {

	var ary = wisely_txt[wisely_idx % wisely_txt.length]
	var txt = ary[0]


	if (ary.length == 1) {
		alert(txt)
		++wisely_idx
		continue
	}

	var name = ary[1]

	CLNT_NAME = prompt(txt, CLNT_NAME || name)
	if (!CLNT_NAME) continue


	if (CLNT_NAME.toLowerCase() == name.toLowerCase()) {
		++wisely_idx
		CLNT_NAME = null
	}
	else break
}

FU.setCookie('NAME', CLNT_NAME, 2)

function HOST_MSG(key, rcvr, msg) {
  CLNT_SKT.emit('msg', key, rcvr, msg)
}

CLNT_SKT.on('info', info => {
  if (CLNT_KEY == info.key) return

  CLNT_SKT.emit('info', {name: CLNT_NAME})
  CLNT_KEY = info.key
  CLNT_ID = info.id
  log('info',CLNT_ID,CLNT_NAME,CLNT_KEY)
})
</script>
<script src="game/game.js">
	// PROJECT_NAME : name of project
	// GAME_MSG(key, sndr, rcvr, msg) : msg frm host -> clnt
	// GAME_CLNT_INIT() : set up clnt
	// GAME_TICK() : update clnt
</script>
<script>
  document.getElementById('title').innerHTML = PROJECT_NAME
	CLNT_SKT && CLNT_SKT.on('msg', (key, sndr, rcvr, msg) => {
		GAME_MSG(key, sndr, rcvr, msg)
	})

	GAME_HIDE_CURSER && $(canvas).css('cursor', 'none')
	USR_IO_INIT()
	GAME_CLNT_INIT()

	// PT.fun(PT.test_fun)

	CLNT_SKT && CLNT_SKT.emit('info', {name: CLNT_NAME})

	function index_tick() {
		USR_IO_TICK(GAME_TICK)
		window.requestAnimationFrame(index_tick)
	}
	index_tick()

</script>
</body>
